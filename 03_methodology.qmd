# Methodology {#sec-methodology}

In this section, I present the main method used in this thesis: Instrumented Principal Component Analysis (IPCA), introduced by @kellyCharacteristicsAre2019. IPCA estimates latent factors and dynamic factor loadings by linking them to observable asset-specific characteristics. Unlike standard PCA, which assumes static loadings and relies uniquely on return data, IPCA allows factors loadings to vary with asset characteristics, such as size, volatility, volume, or momentum, which act as instruments for the conditional loadings. Moreover, it enables the estimation of $K$ factor loadings directly from the panel of asset characteristics.

## IPCA model

Consider a linear factor model. Let $r_{i,t+1} \in \mathbb{R}$ denote the excess return on cryptocurrency $i$ from period $t$ to $t+1$, for $i = 1, \dots, N$ and $t = 1, \dots, T$. The general IPCA model specification is defined as
$$
r_{i,t+1} = \alpha_{i,t} + \beta_{i,t}' f_{t+1} + \epsilon_{i,t+1},
$${#eq-ipca}

with 
$$
\alpha_{i,t} = z'_{i,t}\Gamma_\alpha + \nu_{\alpha,i,t}, \quad 
\beta_{i,t} = z'_{i,t}\Gamma_\beta + \nu_{\beta,i,t},
$$

where $f_{t+1} \in \mathbb{R}^K$ is the $K \times 1$ vector of latent factors. The $K \times 1$ vector $\beta_{i,t}$ captures the dynamic factor loadings, which may depend on observable cryptocurrency characteristics contained in the $L \times 1$ vector of instruments $z_{i,t}$. The main idea is that linking model parameters to observable characteristics allows expected returns to adjust more quickly to new information than when using parameter estimates from rolling window time-series regressions [@bianchiMispricingRiskCompensation2021]. This link is captured through the $L \times K$ matrix $\Gamma_\beta$, which maps a potentially large number of cryptocurrency characteristics $L$ into a small number $K$ of latent factor loadings. Similarly, the $L \times 1$ vector $\Gamma_\alpha$ maps characteristics to anomaly intercepts. Finally, the terms $\nu_{\alpha, i, t}$ and $\nu_{\beta, i, t}$ are residuals that capture variation in loadings orthogonal to the observable instruments. 

In IPCA, two specifications can be considered. As discussed earlier, characteristics are used as instruments for the time-variation in conditional loadings, so that the mapping $z_{i,t} \mapsto \beta_{i,t}$ is determined by the low-dimensional matrix $\Gamma_\beta$. A distinction is then made between a restricted and an unrestricted specification. The restricted model imposes $\Gamma_\alpha = \mathbf{0}$ and assumes that characteristics affect expected returns only through risk exposures, which means there are no “anomaly” intercepts. In contrast, the unrestricted model sets $\Gamma_\alpha \neq \mathbf{0}$, with $\alpha_{i,t}$ capturing mean returns from characteristics that are not determined by risk exposures alone.

For the restricted model, @eq-ipca can be rewritten in vector form as

$$
r_{t+1} = Z_t\Gamma_{\beta}f_{t+1} + \epsilon^*_{t+1},
$$

where $r_{t+1}$ is an $N \times 1$ vector of individual cryptocurrency returns, $Z_t$ is the $N \times L$ matrix of stacked characteristics, and $\epsilon^*_{t+1} = \epsilon_{t+1} + \nu_{\alpha,t} + \nu_{\beta,t}f_{t+1}$ is a composite error vector stacking individual residuals. The estimation problem is to minimize the sum of squared composite model errors: 

$$
\min_{\Gamma_\beta, F} \sum_{t=1}^{T-1} 
\left(r_{t+1} - Z_t \Gamma_\beta f_{t+1}\right)^{\prime}
\left(r_{t+1} - Z_t \Gamma_\beta f_{t+1}\right)
$$

The solution is obtained by alternating least squares, iterating the first-order conditions of $f_{t+1}$ and $\Gamma_\beta$ [@bianchiMispricingRiskCompensation2021]:

$$
\hat{f}_{t+1} = \left(\hat{\Gamma}_\beta^{\prime} Z_t^{\prime} Z_t \hat{\Gamma}_\beta \right)^{-1}
\hat{\Gamma}_\beta^{\prime} Z_t^{\prime} r_{t+1}, 
\quad \forall t
$${#eq-condition1}

$$
\operatorname{vec}(\hat{\Gamma}_\beta) =
\left(
\sum_{t=1}^{T-1} Z_t^{\prime} Z_t \otimes \hat{f}_{t+1} \hat{f}_{t+1}^{\prime}
\right)^{-1}
\left(
\sum_{t=1}^{T-1} \left[ Z_t \otimes \hat{f}_{t+1} \right]^{\prime} r_{t+1}
\right)
$${#eq-condition2}

In this sense, ALS alternates between estimating factor realizations via cross-sectional regressions on latent loadings (@eq-condition1) and updating $\Gamma_\beta$ through regressions on factors interacted with characteristics (@eq-condition2).




